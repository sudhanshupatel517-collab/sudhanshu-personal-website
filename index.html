<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudhanshu's Personal Website</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use the Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Add a subtle smooth scroll effect for navigation */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        .text-pink-500 {
            color: #ec4899;
        }

        /* Animation for the profile picture bubble effect */
        @keyframes bubble {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bubble {
            animation: bubble 4s ease-in-out infinite;
        }

        /* Heart animation keyframes for the flying hearts */
        @keyframes flying-heart {
            0% {
                transform: translateY(0) scale(0.8);
                opacity: 1;
            }
            100% {
                transform: translateY(-80px) scale(1.2);
                opacity: 0;
            }
        }
        .flying-heart {
            animation: flying-heart 1.5s ease-out forwards;
            position: absolute;
            z-index: 10;
            pointer-events: none; /* Prevents the heart from being clickable */
            font-size: 24px; /* Adjust size of the flying heart */
        }

        /* CSS for heart icon state change */
        #heart-btn .outline-heart {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #heart-btn.liked .outline-heart {
            opacity: 0;
            transform: scale(0);
        }
        #heart-btn.liked .filled-heart {
            opacity: 1;
            transform: scale(1);
        }

        /* Styling for the relocated comments section */
        #comments-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        #comments-container.show {
            max-height: 500px; /* Adjust as needed, should be larger than the max height of the content */
        }

        /* Styling for the forms in the auth modal */
        .auth-form-content {
            display: none;
        }
        .auth-form-content.active {
            display: block;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header and Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto p-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-indigo-600">SUDHANSHU</a>
            <div class="space-x-4">
                <a href="#about" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">About</a>
                <a href="#projects" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">Projects</a>
                <a href="#contact" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">Contact</a>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="hero" class="bg-indigo-600 text-white py-20 md:py-32">
        <div class="container mx-auto text-center px-4">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 animate-fade-in-down">Hello, I'm Sudhanshu</h1>
            <p class="text-xl md:text-2xl font-light mb-8 animate-fade-in-up">An adventurous traveler and passionate storyteller.</p>
            <a href="#contact" class="bg-white text-indigo-600 font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105">Get in Touch</a>
        </div>
    </section>

    <!-- About Me Section -->
    <section id="about" class="py-16 md:py-24 bg-white">
        <div class="container mx-auto px-4 flex flex-col md:flex-row items-center gap-8">
            <div class="md:w-1/4">
                <!-- Image source updated with the correct public GitHub URL, and size adjusted to be smaller -->
                <img id="profile-pic" src="https://github.com/sudhanshupatel517-collab/sudhanshu-personal-website/blob/main/IMG_20250226_073021.jpg?raw=true" alt="Sudhanshu's Photo" class="w-full max-w-xs h-auto rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300 animate-bubble">
                
                <!-- Social Interaction Section -->
                <div class="mt-4 text-center flex justify-center gap-4">
                    <!-- Button for the heart icon -->
                    <button id="heart-btn" class="relative flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                        <!-- SVG for the outline heart icon (default state) -->
                        <svg class="h-8 w-8 text-gray-800 stroke-current outline-heart" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                        <!-- SVG for the filled heart icon (liked state) -->
                        <svg class="h-8 w-8 text-pink-500 fill-current filled-heart" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor" stroke-width="0" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </button>
                    <!-- Button for the share icon -->
                    <button id="share-btn" class="flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                        <!-- SVG for a bent arrow pointing right with a black outline and no fill -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-800 stroke-current hover:text-gray-700 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 9L17 12.5M17 12.5L13.5 16M17 12.5H6c-3 0-3 3-3 3s0-3 3-3h11z" />
                        </svg>
                    </button>
                    <!-- New button for the message icon -->
                    <button id="message-btn" class="flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                        <!-- SVG for a message icon with a black outline and no fill -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-800 stroke-current hover:text-gray-700 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4l-3 3v-3z" />
                        </svg>
                    </button>
                </div>

                <!-- Comments section, now placed here -->
                <div id="comments-container" class="mt-8 mx-auto w-full">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Comments</h3>
                    <div class="bg-white p-4 rounded-xl shadow-md mb-4">
                        <form id="comment-form">
                            <textarea id="comment-input" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Write a comment..." rows="2"></textarea>
                            <div class="mt-2 text-right">
                                <button type="submit" class="bg-indigo-600 text-white text-sm font-semibold py-1 px-4 rounded-full shadow hover:bg-indigo-700 transition-colors duration-300">Post</button>
                            </div>
                        </form>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">Logged in as: <span id="user-name" class="font-mono text-xs font-semibold">Not logged in</span></p>
                    <div id="comments-list" class="space-y-3">
                        <!-- Comments will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="md:w-3/4">
                <h2 class="text-3xl font-bold text-gray-900 mb-4">It's me</h2>
                <p class="text-lg text-gray-700 leading-relaxed mb-4">
                    Welcome to my corner of the internet! I'm a passionate creator and a curious traveler. I love exploring new places and sharing my experiences. You can follow my adventures on my YouTube channel, <a href="https://youtube.com/shorts/TsQi8imO744?si=QxERlVNELaMawQOa" target="_blank" class="text-indigo-600 hover:underline font-semibold">Ghumakkad Sudhanshu</a>.
                </p>
                <p class="text-lg text-gray-700 leading-relaxed">
                    My background is in B.Tech in AIML from a college named MITs in Gwalior. It's my pleasure to serve you some content what you actually deserve. Hope you will support me on my journey from downfall to success. THANKS, your SUDHANSHU.
                </p>
            </div>
        </div>
    </section>

    <!-- Projects Section -->
    <section id="projects" class="py-16 md:py-24 bg-gray-100">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-gray-900 text-center mb-12">My Projects</h2>
            <div class="grid grid-cols-1 gap-8">
                <!-- Project Card 1 -->
                <div class="bg-white rounded-xl shadow-lg p-6 transform hover:scale-105 transition-transform duration-300">
                    <img src="https://placehold.co/1200x600/90a4ae/ffffff?text=Rakshabandhan+Family+Picture" alt="Rakshabandhan Project Image" class="rounded-lg mb-4">
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">RAKSHABANDHAN SPECIAL</h3>
                    <p class="text-gray-600">A special project dedicated to my family on the occasion of Rakshabandhan. This section will soon feature a family picture and a heartfelt message.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-16 md:py-24 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-gray-900 text-center mb-8">Get in Touch</h2>
            <div class="max-w-xl mx-auto">
                <p class="text-center text-lg text-gray-600 mb-8">
                    I'm always open to new opportunities and collaborations. Feel free to send me a message!
                </p>
                <form class="bg-gray-50 p-8 rounded-xl shadow-md">
                    <div class="mb-4">
                        <label for="name" class="block text-gray-700 font-medium mb-2">Name</label>
                        <input type="text" id="name" name="name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Your Name">
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-gray-700 font-medium mb-2">Email</label>
                        <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="your.email@example.com">
                    </div>
                    <div class="mb-6">
                        <label for="message" class="block text-gray-700 font-medium mb-2">Message</label>
                        <textarea id="message" name="message" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Your message..."></textarea>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="w-full md:w-auto bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform hover:scale-105">Send Message</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto text-center px-4">
            <p>&copy; 2024 Sudhanshu. All rights reserved.</p>
        </div>
    </footer>

    <!-- Custom Modals -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            <h3 id="modal-title" class="text-lg font-bold mb-2"></h3>
            <p id="modal-message" class="text-gray-700 mb-4"></p>
            <div class="text-right">
                <button id="modal-close" class="bg-indigo-600 text-white py-2 px-4 rounded-full hover:bg-indigo-700">OK</button>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            
            <!-- Auth Content Container - This will hold all the different forms -->
            <div id="auth-content-container">

                <!-- Login Options - Main entry point -->
                <div id="auth-options" class="auth-form-content active">
                    <h3 class="text-2xl font-bold mb-4 text-center">Join to Interact</h3>
                    <p class="text-gray-700 text-center mb-6">Please sign in to like and comment.</p>
                    <button id="google-login-btn" class="w-full flex items-center justify-center gap-3 bg-blue-500 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-600 transition-colors duration-300 mb-4">
                        <img src="https://github.com/sudhanshupatel517-collab/sudhanshu-personal-website/blob/main/download.webp?raw=true" alt="Custom login icon" class="h-6 w-6">
                        Login with Google
                    </button>
                    <button id="show-phone-login-btn" class="w-full flex items-center justify-center gap-3 bg-gray-800 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-gray-900 transition-colors duration-300 mb-4">
                        Login with Phone
                    </button>
                    <button id="show-register-options-btn" class="w-full text-indigo-600 font-semibold py-3 px-8 rounded-full shadow-md bg-white hover:bg-gray-100 transition-colors duration-300">
                        Create an Account
                    </button>
                </div>

                <!-- Registration Options - New page for choosing registration method -->
                <div id="register-options" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center">Create an Account</h3>
                    <p class="text-gray-700 text-center mb-6">Choose how you'd like to register.</p>
                    <button id="show-email-register-btn" class="w-full flex items-center justify-center gap-3 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 mb-4">
                        Register with Email
                    </button>
                    <button id="show-phone-register-btn" class="w-full flex items-center justify-center gap-3 bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300 mb-4">
                        Register with Phone
                    </button>
                    <button type="button" id="back-to-auth-options-btn-1" class="w-full mt-4 text-indigo-600 font-semibold py-3 px-8">Back to Login</button>
                </div>

                <!-- Email Registration Form (Existing) -->
                <form id="register-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center">Register with Email</h3>
                    <p class="text-gray-700 text-center mb-6">Enter your details to get started.</p>
                    <div class="mb-4">
                        <label for="register-name" class="block text-gray-700 font-medium mb-2">Name</label>
                        <input type="text" id="register-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="e.g., Jane Doe" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block text-gray-700 font-medium mb-2">Email</label>
                        <input type="email" id="register-email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="your.email@example.com" required>
                    </div>
                    <div class="mb-6">
                        <label for="register-password" class="block text-gray-700 font-medium mb-2">Password</label>
                        <input type="password" id="register-password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="at least 6 characters" required>
                    </div>
                    <button type="submit" id="register-submit-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300">Register</button>
                    <button type="button" id="back-to-register-options-btn-1" class="w-full mt-4 text-indigo-600 font-semibold py-3 px-8">Back</button>
                </form>

                <!-- Phone Login Form -->
                <form id="phone-login-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center">Login with Phone</h3>
                    <div class="mb-4">
                        <label for="phone-login-input" class="block text-gray-700 font-medium mb-2">Phone Number</label>
                        <input type="tel" id="phone-login-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="+91 98765 43210" required>
                    </div>
                    <div id="recaptcha-container-login" class="mt-4 mb-6"></div>
                    <button type="submit" id="send-otp-login-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300">Send OTP</button>
                    <button type="button" id="back-to-auth-options-btn-2" class="w-full mt-4 text-indigo-600 font-semibold py-3 px-8">Back to Login</button>
                </form>

                <!-- Phone Registration Form (New) -->
                <form id="phone-register-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center">Register with Phone</h3>
                    <p class="text-gray-700 text-center mb-6">Enter your name and phone number.</p>
                    <div class="mb-4">
                        <label for="phone-register-name" class="block text-gray-700 font-medium mb-2">Name</label>
                        <input type="text" id="phone-register-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="e.g., Jane Doe" required>
                    </div>
                    <div class="mb-4">
                        <label for="phone-register-input" class="block text-gray-700 font-medium mb-2">Phone Number</label>
                        <input type="tel" id="phone-register-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="+91 98765 43210" required>
                    </div>
                    <div id="recaptcha-container-register" class="mt-4 mb-6"></div>
                    <button type="submit" id="send-otp-register-btn" class="w-full bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300">Send OTP</button>
                    <button type="button" id="back-to-register-options-btn-2" class="w-full mt-4 text-indigo-600 font-semibold py-3 px-8">Back</button>
                </form>

                <!-- OTP Verification Form (Used for both login and register) -->
                <form id="otp-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center">Verify Phone</h3>
                    <p class="text-center text-sm text-gray-600 mb-4">Enter the 6-digit code sent to your phone number.</p>
                    <div class="mb-4">
                        <label for="otp-input" class="block text-gray-700 font-medium mb-2">Verification Code</label>
                        <input type="text" id="otp-input" class="w-full p-3 border border-gray-300 rounded-lg text-center text-xl tracking-widest focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" maxlength="6" required>
                    </div>
                    <button type="submit" id="verify-otp-btn" class="w-full bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300">Verify OTP</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, updateProfile, GoogleAuthProvider, signInWithPopup, RecaptchaVerifier, signInWithPhoneNumber, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration and initialization
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db, auth;
        let isAuthReady = false;
        let confirmationResult;
        let appVerifierLogin;
        let appVerifierRegister;
        let isPhoneRegisterFlow = false; // Flag to differentiate between login and register flow

        // Custom modal functions
        function showModal(title, message) {
            const modal = document.getElementById('modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            modal.style.display = 'flex';
        }

        document.getElementById('modal-close').addEventListener('click', () => {
            document.getElementById('modal').style.display = 'none';
        });

        // Auth modal functions
        function showAuthModal() {
            document.getElementById('auth-modal').style.display = 'flex';
            // Show the initial login options by default
            switchAuthForm('auth-options');
        }

        function hideAuthModal() {
            document.getElementById('auth-modal').style.display = 'none';
        }
        
        // Function to switch between the different forms in the auth modal
        function switchAuthForm(formId) {
            const forms = document.querySelectorAll('.auth-form-content');
            forms.forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(formId).classList.add('active');
        }

        // Initialize Firebase on window load
        window.onload = async function() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Sign in with custom token or anonymously
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Initialize RecaptchaVerifier for phone login
                appVerifierLogin = new RecaptchaVerifier(auth, 'recaptcha-container-login', {
                    'size': 'invisible'
                });

                // Initialize RecaptchaVerifier for phone registration
                appVerifierRegister = new RecaptchaVerifier(auth, 'recaptcha-container-register', {
                    'size': 'invisible'
                });
                
                // Auth state listener
                onAuthStateChanged(auth, user => {
                    if (user) {
                        isAuthReady = true;
                        // Use display name if available, otherwise use a generic label
                        const userName = user.displayName || `User ${user.uid.substring(0, 8)}`;
                        document.getElementById('user-name').textContent = userName;
                        
                        // Start listening for comments after authentication is ready
                        setupCommentsListener();
                    } else {
                        isAuthReady = true;
                        document.getElementById('user-name').textContent = 'Not logged in';
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showModal("Error", "Failed to initialize the comment system.");
            }
        }

        // Google Login Button Handler
        const googleLoginBtn = document.getElementById('google-login-btn');
        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                hideAuthModal();
                // onAuthStateChanged will handle the rest
            } catch (error) {
                console.error("Google sign-in error:", error);
                showModal("Sign-in Failed", "Could not sign in with Google. Please try again.");
            }
        });

        // Show Phone Login form
        document.getElementById('show-phone-login-btn').addEventListener('click', () => {
            switchAuthForm('phone-login-form');
        });

        // Show Registration Options
        document.getElementById('show-register-options-btn').addEventListener('click', () => {
            switchAuthForm('register-options');
        });

        // Show Email Registration form
        document.getElementById('show-email-register-btn').addEventListener('click', () => {
            switchAuthForm('register-form');
        });

        // Show Phone Registration form
        document.getElementById('show-phone-register-btn').addEventListener('click', () => {
            isPhoneRegisterFlow = true;
            switchAuthForm('phone-register-form');
        });

        // Back buttons
        document.getElementById('back-to-auth-options-btn-1').addEventListener('click', () => {
            switchAuthForm('auth-options');
        });
        document.getElementById('back-to-auth-options-btn-2').addEventListener('click', () => {
            switchAuthForm('auth-options');
        });
        document.getElementById('back-to-register-options-btn-1').addEventListener('click', () => {
            switchAuthForm('register-options');
        });
        document.getElementById('back-to-register-options-btn-2').addEventListener('click', () => {
            isPhoneRegisterFlow = false;
            switchAuthForm('register-options');
        });
        
        // Email Registration Form Submission Handler
        const registerForm = document.getElementById('register-form');
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;

            if (name.length < 1 || password.length < 6) {
                showModal("Invalid Input", "Please enter a name and a password of at least 6 characters.");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(userCredential.user, { displayName: name });
                hideAuthModal();
                showModal("Success!", `Welcome, ${name}! You are now registered.`);
            } catch (error) {
                console.error("Registration error:", error);
                showModal("Registration Failed", error.message);
            }
        });

        // Send OTP Button Handler for Phone Login
        const phoneLoginForm = document.getElementById('phone-login-form');
        phoneLoginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const phoneNumber = document.getElementById('phone-login-input').value;
            isPhoneRegisterFlow = false;
            
            if (!phoneNumber || phoneNumber.length < 10) {
                 showModal("Invalid Phone Number", "Please enter a valid phone number with country code.");
                 return;
            }

            try {
                confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, appVerifierLogin);
                switchAuthForm('otp-form');
            } catch (error) {
                console.error("Error sending OTP:", error);
                showModal("Error", "Failed to send OTP. Please check your phone number and try again.");
                appVerifierLogin.render().then(function(widgetId) {
                    grecaptcha.reset(widgetId);
                });
            }
        });

        // Send OTP Button Handler for Phone Registration
        const phoneRegisterForm = document.getElementById('phone-register-form');
        phoneRegisterForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const phoneNumber = document.getElementById('phone-register-input').value;
            const name = document.getElementById('phone-register-name').value;
            
            if (!phoneNumber || phoneNumber.length < 10 || !name) {
                 showModal("Invalid Input", "Please enter a valid phone number with country code and a name.");
                 return;
            }
            isPhoneRegisterFlow = true;

            try {
                confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, appVerifierRegister);
                switchAuthForm('otp-form');
            } catch (error) {
                console.error("Error sending OTP:", error);
                showModal("Error", "Failed to send OTP. Please check your phone number and try again.");
                appVerifierRegister.render().then(function(widgetId) {
                    grecaptcha.reset(widgetId);
                });
            }
        });
        
        // Verify OTP Button Handler
        const otpForm = document.getElementById('otp-form');
        otpForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const otpCode = document.getElementById('otp-input').value;
            
            if (otpCode.length !== 6) {
                showModal("Invalid OTP", "Please enter the 6-digit code.");
                return;
            }

            try {
                const userCredential = await confirmationResult.confirm(otpCode);
                // If it's a registration flow, update the user's name
                if (isPhoneRegisterFlow) {
                    const name = document.getElementById('phone-register-name').value;
                    await updateProfile(userCredential.user, { displayName: name });
                }
                hideAuthModal();
                // onAuthStateChanged will handle the rest
            } catch (error) {
                console.error("Error verifying OTP:", error);
                showModal("Verification Failed", "The code was incorrect or expired. Please try again.");
            }
        });

        // Heart button functionality
        const heartBtn = document.getElementById('heart-btn');
        const profilePic = document.getElementById('profile-pic');

        heartBtn.addEventListener('click', () => {
            if (!auth.currentUser) {
                showAuthModal();
                return;
            }
            
            const isLiked = heartBtn.classList.toggle('liked');
            
            // Create a flying heart only when liking
            if (isLiked) {
                createFlyingHeart();
            }
        });

        // Function to create and animate a flying heart
        function createFlyingHeart() {
            const heart = document.createElement('span');
            heart.classList.add('flying-heart');
            heart.innerHTML = '❤️';

            // Get the position of the profile picture to launch the heart from
            const picRect = profilePic.getBoundingClientRect();
            const startX = picRect.left + (picRect.width / 2) - 12; // Center the heart horizontally
            const startY = picRect.top + (picRect.height / 2) - 12; // Center the heart vertically

            heart.style.left = `${startX}px`;
            heart.style.top = `${startY}px`;
            
            document.body.appendChild(heart);

            // Remove the heart from the DOM after the animation is complete
            heart.addEventListener('animationend', () => {
                heart.remove();
            });
        }

        // Share button functionality
        const shareBtn = document.getElementById('share-btn');
        shareBtn.addEventListener('click', async () => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Sudhanshu\'s Personal Website',
                        text: 'Check out this awesome personal website!',
                        url: window.location.href
                    });
                    console.log('Page shared successfully');
                } catch (error) {
                    console.error('Error sharing:', error);
                    showModal('Sharing Failed', 'Could not share the page.');
                }
            } else {
                showModal('Sharing Not Supported', 'Your browser does not support the Web Share API. Please copy the URL manually.');
            }
        });

        // Message button functionality
        const messageBtn = document.getElementById('message-btn');
        const commentsContainer = document.getElementById('comments-container');

        messageBtn.addEventListener('click', () => {
            if (!auth.currentUser) {
                showAuthModal();
                return;
            }
            commentsContainer.classList.toggle('show');
        });

        // Firestore comments functionality
        function setupCommentsListener() {
            if (!isAuthReady || !db) {
                return;
            }

            // Path for public comments
            const commentsPath = `/artifacts/${appId}/public/data/comments`;
            const q = query(collection(db, commentsPath));

            onSnapshot(q, (querySnapshot) => {
                const commentsList = document.getElementById('comments-list');
                commentsList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const commentData = doc.data();
                    const commentElement = document.createElement('div');
                    commentElement.classList.add('bg-gray-100', 'p-3', 'rounded-lg', 'shadow-sm');
                    
                    const timeString = commentData.timestamp ? new Date(commentData.timestamp.seconds * 1000).toLocaleString() : 'Just now';
                    
                    const userName = commentData.userName || `User ${commentData.userId.substring(0, 8)}`;
                    
                    commentElement.innerHTML = `
                        <p class="text-xs text-gray-500 mb-1">By: ${userName} - ${timeString}</p>
                        <p class="text-sm text-gray-800">${commentData.text}</p>
                    `;
                    commentsList.appendChild(commentElement);
                });
            }, (error) => {
                console.error("Error fetching comments:", error);
                showModal("Error", "Could not load comments.");
            });
        }
        
        // Comment form submission
        const commentForm = document.getElementById('comment-form');
        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const commentInput = document.getElementById('comment-input');
            const commentText = commentInput.value.trim();

            if (!auth.currentUser) {
                showAuthModal();
                return;
            }

            if (commentText === '') {
                showModal("Input Required", "Please write a comment before posting.");
                return;
            }
            
            try {
                const commentsPath = `/artifacts/${appId}/public/data/comments`;
                await addDoc(collection(db, commentsPath), {
                    userId: auth.currentUser.uid,
                    userName: auth.currentUser.displayName,
                    text: commentText,
                    timestamp: serverTimestamp()
                });
                commentInput.value = ''; // Clear the input field
            } catch (error) {
                console.error("Error adding comment:", error);
                showModal("Error", "Failed to post comment.");
            }
        });
    </script>

</body>
</html>
