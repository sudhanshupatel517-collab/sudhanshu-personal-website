<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudhanshu's Personal Website</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use the Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Add a subtle smooth scroll effect for navigation */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        .text-pink-500 {
            color: #ec4899;
        }

        /* Animation for the profile picture bubble effect */
        @keyframes bubble {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bubble {
            animation: bubble 4s ease-in-out infinite;
        }

        /* Heart animation keyframes for the flying hearts */
        @keyframes flying-heart {
            0% {
                transform: translateY(0) scale(0.8);
                opacity: 1;
            }
            100% {
                transform: translateY(-80px) scale(1.2);
                opacity: 0;
            }
        }
        .flying-heart {
            animation: flying-heart 1.5s ease-out forwards;
            position: absolute;
            z-index: 10;
            pointer-events: none; /* Prevents the heart from being clickable */
            font-size: 24px; /* Adjust size of the flying heart */
        }

        /* CSS for heart icon state change */
        /* The heart button itself has a relative position to correctly position the filled heart */
        #heart-btn {
            position: relative;
        }
        /* Both hearts start with opacity 0 so they don't flash on load */
        #heart-btn .outline-heart,
        #heart-btn .filled-heart {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            position: absolute;
            top: 0;
            left: 0;
        }
        /* Default state: show outline heart, hide filled heart */
        #heart-btn:not(.liked) .outline-heart {
            opacity: 1;
            transform: scale(1);
        }
        #heart-btn:not(.liked) .filled-heart {
            opacity: 0;
            transform: scale(0);
        }
        /* Liked state: hide outline heart, show filled heart */
        #heart-btn.liked .outline-heart {
            opacity: 0;
            transform: scale(0);
        }
        #heart-btn.liked .filled-heart {
            opacity: 1;
            transform: scale(1);
        }

        /* Comment heart button styling */
        .heart-btn-comment .outline-heart,
        .heart-btn-comment .filled-heart {
             transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .heart-btn-comment .filled-heart {
            opacity: 0;
        }
        .heart-btn-comment.liked .outline-heart {
            opacity: 0;
        }
        .heart-btn-comment.liked .filled-heart {
            opacity: 1;
        }

        /* Styling for the relocated comments section */
        #comments-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        #comments-container.show {
            max-height: 500px; /* Adjust as needed, should be larger than the max height of the content */
        }

        /* Styling for the forms in the auth modal */
        .auth-form-content {
            display: none;
        }
        .auth-form-content.active {
            display: block;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header and Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto p-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-indigo-600">SUDHANSHU</a>
            <div class="space-x-4 flex items-center">
                <a href="#about" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">About</a>
                <a href="#projects" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">Projects</a>
                <a href="#contact" class="text-gray-600 hover:text-indigo-600 transition-colors duration-300">Contact</a>
                <!-- New Profile/Logout Button -->
                <button id="profile-btn" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform hover:scale-105">Profile</button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Hero Section -->
        <section id="hero" class="bg-indigo-600 text-white py-20 md:py-32">
            <div class="container mx-auto text-center px-4">
                <h1 class="text-4xl md:text-6xl font-extrabold mb-4 animate-fade-in-down">Hello, I'm Sudhanshu</h1>
                <p class="text-xl md:text-2xl font-light mb-8 animate-fade-in-up">An adventurous traveler and passionate storyteller.</p>
                <a href="#contact" class="bg-white text-indigo-600 font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105">Get in Touch</a>
            </div>
        </section>

        <!-- About Me Section -->
        <section id="about" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4 flex flex-col md:flex-row items-center gap-8">
                <div class="md:w-1/4">
                    <!-- Image source updated with the correct public GitHub URL, and size adjusted to be smaller -->
                    <img id="profile-pic" src="https://github.com/sudhanshupatel517-collab/sudhanshu-personal-website/blob/main/IMG_20250226_073021.jpg?raw=true" alt="Sudhanshu's Photo" class="w-full max-w-xs h-auto rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300 animate-bubble">
                    
                    <!-- Social Interaction Section -->
                    <div class="mt-4 text-center flex justify-center items-center gap-2">
                        <!-- Button for the heart icon -->
                        <button id="heart-btn" class="flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                            <!-- SVG for the outline heart icon (default state) -->
                            <svg class="h-8 w-8 text-gray-800 stroke-current outline-heart" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                            <!-- SVG for the filled heart icon (liked state) -->
                            <svg class="h-8 w-8 text-pink-500 fill-current filled-heart absolute" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor" stroke-width="0" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>
                        <span id="profile-likes-count" class="text-lg font-semibold text-gray-700">0</span>
                        <!-- Button for the share icon -->
                        <button id="share-btn" class="flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                            <!-- SVG for a bent arrow pointing right with a black outline and no fill -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-800 stroke-current hover:text-gray-700 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 9L17 12.5M17 12.5L13.5 16M17 12.5H6c-3 0-3 3-3 3s0-3 3-3h11z" />
                            </svg>
                        </button>
                        <!-- New button for the message icon -->
                        <button id="message-btn" class="flex items-center justify-center p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 transform hover:scale-110">
                            <!-- SVG for a message icon with a black outline and no fill -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-800 stroke-current hover:text-gray-700 transition-colors duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4l-3 3v-3z" />
                            </svg>
                        </button>
                    </div>

                    <!-- Comments section, now placed here -->
                    <div id="comments-container" class="mt-8 mx-auto w-full">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Comments</h3>
                        <div class="bg-white p-4 rounded-xl shadow-md mb-4">
                            <form id="comment-form">
                                <textarea id="comment-input" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Write a comment..." rows="2"></textarea>
                                <div class="mt-2 text-right">
                                    <button type="submit" class="bg-indigo-600 text-white text-sm font-semibold py-1 px-4 rounded-full shadow hover:bg-indigo-700 transition-colors duration-300">Post</button>
                                </div>
                            </form>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">Logged in as: <span id="user-name" class="font-mono text-xs font-semibold">Not logged in</span></p>
                        <div id="comments-list" class="space-y-3">
                            <!-- Comments will be dynamically added here -->
                        </div>
                    </div>
                </div>
                <div class="md:w-3/4">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">It's me</h2>
                    <p class="text-lg text-gray-700 leading-relaxed mb-4">
                        Welcome to my corner of the internet! I'm a passionate creator and a curious traveler. I love exploring new places and sharing my experiences. You can follow my adventures on my YouTube channel, <a href="https://youtube.com/shorts/TsQi8imO744?si=QxERlVNelaMawQOa" target="_blank" class="text-indigo-600 hover:underline font-semibold">Ghumakkad Sudhanshu</a>.
                    </p>
                    <p class="text-lg text-gray-700 leading-relaxed">
                        My background is in B.Tech in AIML from a college named MITs in Gwalior. It's my pleasure to serve you some content what you actually deserve. Hope you will support me on my journey from downfall to success. THANKS, your SUDHANSHU.
                    </p>
                </div>
            </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-gray-900 text-center mb-12">My Projects</h2>
                <div class="grid grid-cols-1 gap-8">
                    <!-- Project Card 1 -->
                    <div class="bg-white rounded-xl shadow-lg p-6 transform hover:scale-105 transition-transform duration-300">
                        <img src="https://placehold.co/1200x600/90a4ae/ffffff?text=Rakshabandhan+Family+Picture" alt="Rakshabandhan Project Image" class="rounded-lg mb-4">
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">RAKSHABANDHAN SPECIAL</h3>
                        <p class="text-gray-600">A special project dedicated to my family on the occasion of Rakshabandhan. This section will soon feature a family picture and a heartfelt message.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-gray-900 text-center mb-8">Get in Touch</h2>
                <div class="max-w-xl mx-auto">
                    <!-- Container for the form and the success message -->
                    <div id="contact-content-container">
                        <!-- Added id="contact-form" for JavaScript functionality -->
                        <form id="contact-form" class="bg-gray-50 p-8 rounded-xl shadow-md">
                            <div class="mb-4">
                                <label for="name" class="block text-gray-700 font-medium mb-2">Name</label>
                                <!-- Added id="contact-name" to easily select this input -->
                                <input type="text" id="contact-name" name="name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Your Name">
                            </div>
                            <div class="mb-4">
                                <label for="email" class="block text-gray-700 font-medium mb-2">Email</label>
                                <!-- Added id="contact-email" to easily select this input -->
                                <input type="email" id="contact-email" name="email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="your.email@example.com">
                            </div>
                            <div class="mb-6">
                                <label for="message" class="block text-gray-700 font-medium mb-2">Message</label>
                                <!-- Added id="contact-message" to easily select this input -->
                                <textarea id="contact-message" name="message" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors duration-200" placeholder="Your message..."></textarea>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="w-full md:w-auto bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform hover:scale-105">Send Message</button>
                            </div>
                        </form>
                        <!-- New success message div -->
                        <div id="contact-success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl relative text-center">
                            <h3 class="font-bold text-xl mb-2">Message Sent!</h3>
                            <p class="text-lg">Thank you for getting in touch. I will respond to your message as soon as possible.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto text-center px-4">
            <p>&copy; 2024 Sudhanshu. All rights reserved.</p>
        </div>
    </footer>

    <!-- Custom Modals -->
    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
            <h3 id="modal-title" class="text-lg font-bold mb-2"></h3>
            <p id="modal-message" class="text-gray-700 mb-4"></p>
            <div class="text-right">
                <button id="modal-close" class="bg-indigo-600 text-white py-2 px-4 rounded-full hover:bg-indigo-700">OK</button>
            </div>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm">

            <!-- Unified container for all forms -->
            <div id="auth-content-container">
                
                <!-- Login Form (now the default view) -->
                <form id="login-form" class="auth-form-content active">
                    <h3 class="text-2xl font-bold mb-4 text-center text-gray-800">Login to Your Account</h3>
                    <p class="text-gray-600 text-center mb-6">Enter your details to log in to your account.</p>
                    <div class="mb-4">
                        <label for="login-email-phone" class="block text-sm font-medium text-gray-700 mb-1">Email or Phone Number</label>
                        <input type="text" id="login-email-phone" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="your.email@example.com or +1234567890" required>
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Password" required>
                    </div>
                    <div class="flex justify-between items-center mb-6">
                        <label class="flex items-center text-sm text-gray-600">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600" id="remember-me">
                            <span class="ml-2">Remember me</span>
                        </label>
                        <button type="button" id="show-forgot-password-form" class="text-sm font-semibold text-blue-600 hover:text-blue-800">Forgot password?</button>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300">Login</button>
                    <div id="recaptcha-container-login" class="mt-4 mb-6 hidden"></div>
                    <div class="mt-6 text-center">
                        <p class="text-sm text-gray-600">New user? <button type="button" id="show-registration-options" class="text-blue-600 font-semibold hover:text-blue-800">Create an account</button></p>
                    </div>
                </form>

                <!-- Registration Options View -->
                <div id="options-view" class="auth-form-content text-center">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">Create an Account</h3>
                    <p class="text-gray-600 mb-6">Choose how you would like to register:</p>
                    <div class="space-y-4">
                        <button id="show-email-form" class="w-full bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform hover:scale-105">
                            Register with Email
                        </button>
                        <button id="show-phone-form" class="w-full bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300 transform hover:scale-105">
                            Register with Phone
                        </button>
                    </div>
                    <button type="button" id="back-to-login-btn-1" class="w-full mt-4 text-gray-600 font-semibold py-3 px-8">Back</button>
                </div>

                <!-- Email Registration Form -->
                <form id="email-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center text-gray-800">Register with Email</h3>
                    <div class="mb-4">
                        <label for="email-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="email-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Jane Doe" required>
                    </div>
                    <div class="mb-4">
                        <label for="email-input" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="email-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your.email@example.com" required>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-300">Send Link to My Email</button>
                    <button type="button" id="back-to-options-btn-1" class="w-full mt-4 text-gray-600 font-semibold py-3 px-8">Back</button>
                </form>

                <!-- Phone Registration Form -->
                <form id="phone-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center text-gray-800">Register with Phone</h3>
                    <div class="mb-4">
                        <label for="phone-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="phone-name" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Jane Doe" required>
                    </div>
                    <div class="mb-4">
                        <label for="phone-input" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input type="tel" id="phone-input" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="+1234567890" required>
                    </div>
                    <div class="mb-6">
                        <label for="phone-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="phone-password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="at least 6 characters" required>
                    </div>
                    <div id="recaptcha-container-register" class="mt-4 mb-6 hidden"></div>
                    <button type="submit" class="w-full bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300">Send OTP</button>
                    <button type="button" id="back-to-options-btn-2" class="w-full mt-4 text-gray-600 font-semibold py-3 px-8">Back</button>
                </form>

                <!-- Forgot Password Form -->
                <form id="forgot-password-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center text-gray-800">Reset Password</h3>
                    <p class="text-gray-600 text-center mb-6">Enter your email and we will send you a password reset link.</p>
                    <div class="mb-4">
                        <label for="forgot-password-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="forgot-password-email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="your.email@example.com" required>
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-red-700 transition-colors duration-300">Send Reset Link</button>
                    <button type="button" id="back-to-login-btn-2" class="w-full mt-4 text-gray-600 font-semibold py-3 px-8">Back</button>
                </form>

                <!-- OTP Verification Form (for phone registration and login) -->
                <form id="otp-form" class="auth-form-content">
                    <h3 class="text-2xl font-bold mb-4 text-center text-gray-800">Verify Phone Number</h3>
                    <p class="text-center text-sm text-gray-600 mb-4">Enter the 6-digit code sent to your phone.</p>
                    <div class="mb-4">
                        <label for="otp-input" class="block text-sm font-medium text-gray-700 mb-1">Verification Code</label>
                        <input type="text" id="otp-input" class="w-full p-3 border border-gray-300 rounded-lg text-center text-xl tracking-widest focus:outline-none focus:ring-2 focus:ring-green-500" maxlength="6" required>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-green-700 transition-colors duration-300">Verify OTP</button>
                    <button type="button" id="back-from-otp-btn" class="w-full mt-4 text-gray-600 font-semibold py-3 px-8">Back</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, updateProfile, RecaptchaVerifier, signInWithPhoneNumber, sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink, signInWithEmailAndPassword, sendPasswordResetEmail, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, doc, runTransaction, arrayUnion, arrayRemove, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ====================================================================
        // ===  Step 1: PASTE YOUR FIREBASE CONFIGURATION HERE  ===============
        // ====================================================================
        // Go to your Firebase project settings, find "Your apps", and copy
        // the `firebaseConfig` object.
        // DO NOT remove the `const firebaseConfig = ...` part.
        // Replace the placeholder object below with your actual configuration.
        // For example:
        // const firebaseConfig = {
        //   apiKey: "YOUR_API_KEY",
        //   authDomain: "YOUR_AUTH_DOMAIN",
        //   ...
        // };
        // --------------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyBoGH8LFQ4U5iyKQiLRt0foVFhNsa8Myos",
            authDomain: "see-sudhanshu.firebaseapp.com",
            projectId: "see-sudhanshu",
            storageBucket: "see-sudhanshu.firebasestorage.app",
            messagingSenderId: "411257749031",
            appId: "1:411257749031:web:7ef6fe3eaae446343e5802"
        };
        // ====================================================================

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let unsubscribeFromComments = null; // Variable to hold the unsubscribe function for the comments listener
        let unsubscribeFromLikes = null;
        let confirmationResult;
        let appVerifierRegister;
        let appVerifierLogin;
        
        // Custom modal functions
        function showModal(title, message) {
            const modal = document.getElementById('modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            modal.style.display = 'flex';
        }

        document.getElementById('modal-close').addEventListener('click', () => {
            document.getElementById('modal').style.display = 'none';
        });

        // Auth modal functions
        function showAuthModal() {
            document.getElementById('auth-modal').style.display = 'flex';
            // Show the initial login form by default
            switchAuthForm('login-form');
        }

        function hideAuthModal() {
            document.getElementById('auth-modal').style.display = 'none';
        }
        
        // Function to switch between the different forms in the auth modal
        function switchAuthForm(formId) {
            const forms = document.querySelectorAll('.auth-form-content');
            forms.forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(formId).classList.add('active');
        }

        // Initialize Firebase on window load
        window.onload = async function() {
            try {
                // Ensure the Firebase config is not empty before trying to initialize
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey.startsWith("YOUR")) {
                     console.error("Firebase configuration is missing.");
                     showModal("Error", "Firebase configuration is missing. The comment and like system will be disabled. Please update the configuration in the code.");
                     return;
                }

                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                // Sign in with custom token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Auth state listener
                onAuthStateChanged(auth, user => {
                    const profileBtn = document.getElementById('profile-btn');
                    if (user && !user.isAnonymous) {
                        // User is signed in. Update UI and set up listeners.
                        const userName = user.displayName || `User ${user.uid.substring(0, 8)}`;
                        document.getElementById('user-name').textContent = userName;
                        
                        // Update the profile button to show user name and logout
                        profileBtn.textContent = 'Logout';
                        profileBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                        profileBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                        
                        // Stop any existing listeners before starting new ones
                        if (unsubscribeFromComments) { unsubscribeFromComments(); }
                        if (unsubscribeFromLikes) { unsubscribeFromLikes(); }
                        
                        // Set up new listeners for comments and likes
                        setupCommentsListener();
                        setupProfileLikesListener();
                    } else {
                        // User is signed out. Update UI and clean up the listeners.
                        document.getElementById('user-name').textContent = 'Not logged in';
                        document.getElementById('comments-list').innerHTML = ''; // Clear comments list
                        document.getElementById('profile-likes-count').textContent = '0';
                        document.getElementById('heart-btn').classList.remove('liked');

                        // Reset the profile button text and style
                        profileBtn.textContent = 'Profile';
                        profileBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        profileBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');

                        if (unsubscribeFromComments) { unsubscribeFromComments(); unsubscribeFromComments = null; }
                        if (unsubscribeFromLikes) { unsubscribeFromLikes(); unsubscribeFromLikes = null; }
                    }
                });

                // Handle the sign-in redirect from an email link
                if (isSignInWithEmailLink(auth, window.location.href)) {
                    let email = window.localStorage.getItem('emailForSignIn');
                    if (!email) {
                        email = prompt('Please provide your email for confirmation');
                    }
                    if (email) {
                        await signInWithEmailLink(auth, email, window.location.href);
                        window.localStorage.removeItem('emailForSignIn');
                        showModal('Success', 'You have been successfully signed in with your email link!');
                    } else {
                        showModal('Error', 'Please provide an email to complete sign-in.');
                    }
                }

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showModal("Error", "Failed to initialize the comment and like system. Please check the console for details.");
            }
        }
        
        // Profile Button Logic
        document.getElementById('profile-btn').addEventListener('click', () => {
            if (!auth || !db) {
                 showModal("Error", "The authentication system is not available. Please try again later.");
                 return;
            }
            if (auth.currentUser && !auth.currentUser.isAnonymous) {
                // If user is logged in, show a confirmation modal for logout
                showModal('Logout', 'Are you sure you want to log out?');
                document.getElementById('modal-close').textContent = 'Cancel';
                const logoutConfirmBtn = document.createElement('button');
                logoutConfirmBtn.textContent = 'Logout';
                logoutConfirmBtn.classList.add('bg-red-600', 'text-white', 'py-2', 'px-4', 'rounded-full', 'hover:bg-red-700', 'ml-2');
                logoutConfirmBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        document.getElementById('modal').style.display = 'none';
                        document.getElementById('modal-close').textContent = 'OK'; // Reset button text
                        location.reload(); // Reload the page to reset the UI cleanly
                    } catch (error) {
                        showModal('Logout Failed', 'Could not log you out. Please try again.');
                    } finally {
                        logoutConfirmBtn.remove();
                    }
                });
                document.getElementById('modal').querySelector('.text-right').appendChild(logoutConfirmBtn);
            } else {
                // If user is not logged in, show the auth modal
                showAuthModal();
            }
        });
        
        // --- Event Listeners for switching forms ---
        document.getElementById('show-registration-options').addEventListener('click', () => {
            switchAuthForm('options-view');
        });
        document.getElementById('show-forgot-password-form').addEventListener('click', () => {
            switchAuthForm('forgot-password-form');
        });
        document.getElementById('show-email-form').addEventListener('click', () => {
            switchAuthForm('email-form');
        });
        document.getElementById('show-phone-form').addEventListener('click', async () => {
            switchAuthForm('phone-form');
            // Initialize reCAPTCHA for phone registration if it doesn't exist
            if (!appVerifierRegister) {
                 appVerifierRegister = new RecaptchaVerifier(auth, 'recaptcha-container-register', { 'size': 'invisible' });
                 await appVerifierRegister.render();
            }
        });
        document.getElementById('back-to-login-btn-1').addEventListener('click', () => {
            switchAuthForm('login-form');
        });
        document.getElementById('back-to-login-btn-2').addEventListener('click', () => {
            switchAuthForm('login-form');
        });
        document.getElementById('back-to-options-btn-1').addEventListener('click', () => {
            switchAuthForm('options-view');
        });
        document.getElementById('back-to-options-btn-2').addEventListener('click', () => {
            switchAuthForm('options-view');
        });
        document.getElementById('back-from-otp-btn').addEventListener('click', () => {
            // Check if user came from phone login or phone registration
            const isLogin = sessionStorage.getItem('isLogin') === 'true';
            if (isLogin) {
                switchAuthForm('login-form');
            } else {
                switchAuthForm('phone-form');
            }
        });
        
        // --- Login Logic ---
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const identifier = document.getElementById('login-email-phone').value;
            const password = document.getElementById('login-password').value;
        
            // Check if the identifier is a phone number or an email
            const isPhoneNumber = /^\+\d{10,15}$/.test(identifier.trim());
        
            try {
                 if (!auth) {
                     showModal("Error", "Authentication system not initialized.");
                     return;
                 }
                if (isPhoneNumber) {
                    // Sign in with phone number (sends OTP)
                    if (!appVerifierLogin) {
                        appVerifierLogin = new RecaptchaVerifier(auth, 'recaptcha-container-login', { 'size': 'invisible' });
                        await appVerifierLogin.render();
                    }
                    confirmationResult = await signInWithPhoneNumber(auth, identifier, appVerifierLogin);
                    sessionStorage.setItem('isLogin', 'true');
                    showModal('OTP Sent', `A verification code has been sent to ${identifier}.`);
                    switchAuthForm('otp-form');
                    appVerifierLogin.render().then(function(widgetId) {
                         grecaptcha.reset(widgetId);
                     });
                } else {
                    // Sign in with email and password
                    const userCredential = await signInWithEmailAndPassword(auth, identifier, password);
                    console.log("Login successful:", userCredential.user);
                    showModal('Success', `Welcome back, ${userCredential.user.displayName || userCredential.user.email}!`);
                    hideAuthModal();
                }
            } catch (error) {
                console.error("Login error:", error);
                showModal('Login Failed', `Error: ${error.message}`);
                if (appVerifierLogin) {
                     appVerifierLogin.render().then(function(widgetId) {
                         grecaptcha.reset(widgetId);
                     });
                 }
            }
        });

        // --- Email Registration Logic (now using Email Link Auth) ---
        document.getElementById('email-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('email-name').value;
            const email = document.getElementById('email-input').value;

            const actionCodeSettings = {
                url: window.location.href,
                handleCodeInApp: true,
            };

            try {
                if (!auth) {
                     showModal("Error", "Authentication system not initialized.");
                     return;
                }
                window.localStorage.setItem('emailForSignIn', email);
                await sendSignInLinkToEmail(auth, email, actionCodeSettings);

                console.log("Email link sent successfully to", email);
                showModal('Check Your Email', `A verification link has been sent to ${email}. Please check your inbox and click the link to continue registration.`);
                switchAuthForm('login-form');
            } catch (error) {
                console.error("Email link sending error:", error);
                showModal('Registration Failed', `Error sending email link: ${error.message}`);
            }
        });

        // --- Phone Registration & OTP Logic ---
        document.getElementById('phone-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('phone-name').value;
            const phone = document.getElementById('phone-input').value;
            const password = document.getElementById('phone-password').value;

            try {
                 if (!auth) {
                     showModal("Error", "Authentication system not initialized.");
                     return;
                 }
                 if (!appVerifierRegister) {
                     appVerifierRegister = new RecaptchaVerifier(auth, 'recaptcha-container-register', { 'size': 'invisible' });
                     await appVerifierRegister.render();
                 }
                confirmationResult = await signInWithPhoneNumber(auth, phone, appVerifierRegister);
                
                sessionStorage.setItem('tempName', name);
                sessionStorage.setItem('tempPassword', password);
                sessionStorage.setItem('isLogin', 'false');

                console.log("OTP sent successfully to", phone);
                showModal('OTP Sent', `A verification code has been sent to ${phone}.`);
                switchAuthForm('otp-form');
                 appVerifierRegister.render().then(function(widgetId) {
                     grecaptcha.reset(widgetId);
                 });
            } catch (error) {
                console.error("Phone registration error:", error);
                showModal('Registration Failed', `Error sending OTP: ${error.message}`);
                 appVerifierRegister.render().then(function(widgetId) {
                     grecaptcha.reset(widgetId);
                 });
            }
        });

        // --- Forgot Password Logic ---
        document.getElementById('forgot-password-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgot-password-email').value;

            try {
                if (!auth) {
                     showModal("Error", "Authentication system not initialized.");
                     return;
                }
                await sendPasswordResetEmail(auth, email);
                console.log("Password reset email sent to", email);
                showModal('Password Reset Email Sent', `A password reset email has been sent to ${email}. Please check your inbox.`);
                switchAuthForm('login-form');
            } catch (error) {
                console.error("Password reset error:", error);
                showModal('Reset Failed', `Error: ${error.message}`);
            }
        });

        // --- OTP Verification Logic ---
        document.getElementById('otp-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const otpCode = document.getElementById('otp-input').value;

            try {
                if (!auth) {
                     showModal("Error", "Authentication system not initialized.");
                     return;
                }
                const userCredential = await confirmationResult.confirm(otpCode);
                const isLogin = sessionStorage.getItem('isLogin') === 'true';

                if (isLogin) {
                    console.log("Phone login successful:", userCredential.user);
                    showModal('Success', `Welcome back, ${userCredential.user.phoneNumber}!`);
                } else {
                    const name = sessionStorage.getItem('tempName');
                    const password = sessionStorage.getItem('tempPassword');

                    await updateProfile(userCredential.user, { displayName: name });
                    
                    const userId = userCredential.user.uid;
                    const userRef = doc(db, `/artifacts/${appId}/users/${userId}/userData/profile`);
                    await setDoc(userRef, {
                        name: name,
                        email: null, // Phone registration does not include email
                        phone: userCredential.user.phoneNumber,
                        createdAt: serverTimestamp(),
                    });
                    
                    console.log("Phone registration successful:", userCredential.user);
                    showModal('Success', `Account for "${name}" created successfully!`);
                }

                hideAuthModal();
                document.getElementById('phone-form').reset();
                document.getElementById('otp-form').reset();
                sessionStorage.removeItem('tempName');
                sessionStorage.removeItem('tempPassword');
                sessionStorage.removeItem('isLogin');

            } catch (error) {
                console.error("OTP verification error:", error);
                showModal('Verification Failed', `Error: ${error.message}`);
            }
        });

        // Profile heart button functionality
        const heartBtn = document.getElementById('heart-btn');
        const profilePic = document.getElementById('profile-pic');
        const profileLikesCount = document.getElementById('profile-likes-count');

        heartBtn.addEventListener('click', () => {
            if (!auth || !db || !auth.currentUser || auth.currentUser.isAnonymous) {
                showAuthModal();
                return;
            }

            const userId = auth.currentUser.uid;
            const profileLikesRef = doc(db, `/artifacts/${appId}/public/data/profileLikes/profile`);

            // Optimistically update the UI first
            const isLiked = heartBtn.classList.contains('liked');
            if (!isLiked) {
                heartBtn.classList.add('liked');
                createFlyingHeart();
            } else {
                heartBtn.classList.remove('liked');
            }

            // Then, perform the database transaction
            runTransaction(db, async (transaction) => {
                const docSnap = await transaction.get(profileLikesRef);
                const data = docSnap.data() || { likedBy: [] };
                
                const likedBy = data.likedBy || [];
                const alreadyLiked = likedBy.includes(userId);

                if (alreadyLiked) {
                    // User has liked, so unlike it
                    transaction.update(profileLikesRef, {
                        likedBy: arrayRemove(userId)
                    });
                } else {
                    // User has not liked, so like it
                    transaction.set(profileLikesRef, {
                        likedBy: arrayUnion(userId)
                    }, { merge: true });
                }
            }).then(() => {
                console.log("Profile like transaction successful.");
            }).catch(error => {
                console.error("Profile like transaction failed: ", error);
                // Revert the UI state on failure
                heartBtn.classList.toggle('liked');
                showModal("Error", "Failed to update like count. Please try again.");
            });
        });

        // Function to create and animate a flying heart
        function createFlyingHeart() {
            const heart = document.createElement('span');
            heart.classList.add('flying-heart');
            heart.innerHTML = '';

            // Get the position of the profile picture to launch the heart from
            const picRect = profilePic.getBoundingClientRect();
            const startX = picRect.left + (picRect.width / 2) - 12; // Center the heart horizontally
            const startY = picRect.top + (picRect.height / 2) - 12; // Center the heart vertically

            heart.style.left = `${startX}px`;
            heart.style.top = `${startY}px`;
            
            document.body.appendChild(heart);

            // Remove the heart from the DOM after the animation is complete
            heart.addEventListener('animationend', () => {
                heart.remove();
            });
        }

        // Share button functionality
        const shareBtn = document.getElementById('share-btn');
        shareBtn.addEventListener('click', async () => {
             if (!auth || !auth.currentUser) {
                showAuthModal();
                return;
            }

            // Track the share action
            try {
                 await addDoc(collection(db, `/artifacts/${appId}/public/data/shares`), {
                     userId: auth.currentUser.uid,
                     userName: auth.currentUser.displayName,
                     timestamp: serverTimestamp()
                 });
             } catch (error) {
                 console.error("Error logging share action:", error);
             }
             
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Sudhanshu\'s Personal Website',
                        text: 'Check out this awesome personal website!',
                        url: window.location.href
                    });
                    console.log('Page shared successfully');
                } catch (error) {
                    console.error('Error sharing:', error);
                    showModal('Sharing Failed', 'Could not share the page.');
                }
            } else {
                showModal('Sharing Not Supported', 'Your browser does not support the Web Share API. Please copy the URL manually.');
            }
        });

        // Message button functionality
        const messageBtn = document.getElementById('message-btn');
        const commentsContainer = document.getElementById('comments-container');

        messageBtn.addEventListener('click', () => {
            if (!auth || !auth.currentUser || auth.currentUser.isAnonymous) {
                showAuthModal();
                return;
            }
            commentsContainer.classList.toggle('show');
        });
        
        // Function to handle comment likes
        function handleCommentLike(commentId, button) {
            if (!auth || !db || !auth.currentUser || auth.currentUser.isAnonymous) {
                showAuthModal();
                return;
            }

            const userId = auth.currentUser.uid;
            const commentRef = doc(db, `/artifacts/${appId}/public/data/comments`, commentId);

            runTransaction(db, async (transaction) => {
                const docSnap = await transaction.get(commentRef);
                const data = docSnap.data() || { likedBy: [] };
                
                const likedBy = data.likedBy || [];
                const isLiked = likedBy.includes(userId);

                if (isLiked) {
                    // User has liked, so unlike it
                    transaction.update(commentRef, {
                        likedBy: arrayRemove(userId)
                    });
                } else {
                    // User has not liked, so like it
                    transaction.update(commentRef, {
                        likedBy: arrayUnion(userId)
                    });
                }
            }).then(() => {
                console.log(`Comment ${commentId} like transaction successful.`);
            }).catch(error => {
                console.error(`Comment ${commentId} like transaction failed: `, error);
                showModal("Error", "Failed to update comment like count. Please try again.");
            });
        }

        // Firestore comments functionality
        function setupCommentsListener() {
            // Unsubscribe from any previous listener if it exists
            if (unsubscribeFromComments) {
                unsubscribeFromComments();
                unsubscribeFromComments = null;
            }
            
            // Check if user is authenticated before setting up the listener
            if (!auth || !auth.currentUser || auth.currentUser.isAnonymous) {
                return;
            }

            // Path for public comments
            const commentsPath = `/artifacts/${appId}/public/data/comments`;
            const q = query(collection(db, commentsPath));

            unsubscribeFromComments = onSnapshot(q, (querySnapshot) => {
                const commentsList = document.getElementById('comments-list');
                commentsList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const commentData = doc.data();
                    const commentId = doc.id;
                    const commentElement = document.createElement('div');
                    commentElement.classList.add('bg-gray-100', 'p-3', 'rounded-lg', 'shadow-sm');
                    
                    const timeString = commentData.timestamp ? new Date(commentData.timestamp.seconds * 1000).toLocaleString() : 'Just now';
                    
                    const userName = commentData.userName || `User ${commentData.userId.substring(0, 8)}`;
                    
                    // Check if the current user has liked this comment
                    const userId = auth.currentUser.uid;
                    const likedBy = commentData.likedBy || [];
                    const isLiked = likedBy.includes(userId);
                    const likeCount = likedBy.length;
                    
                    commentElement.innerHTML = `
                        <p class="text-xs text-gray-500 mb-1">By: ${userName} - ${timeString}</p>
                        <p class="text-sm text-gray-800">${commentData.text}</p>
                        <div class="flex items-center mt-2 space-x-2">
                           <button class="heart-btn-comment flex items-center p-1 rounded-full hover:bg-gray-200 transition-colors duration-300 ${isLiked ? 'liked' : ''}" data-comment-id="${commentId}">
                               <svg class="h-5 w-5 text-gray-800 stroke-current outline-heart" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                                   <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                               </svg>
                               <svg class="h-5 w-5 text-pink-500 fill-current filled-heart absolute" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor" stroke-width="0" xmlns="http://www.w3.org/2000/svg">
                                   <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                               </svg>
                           </button>
                           <span class="text-sm font-medium text-gray-600">${likeCount}</span>
                        </div>
                    `;
                    commentsList.appendChild(commentElement);
                    
                    // Add event listener to the newly created heart button
                    const newHeartButton = commentElement.querySelector('.heart-btn-comment');
                    newHeartButton.addEventListener('click', () => {
                        handleCommentLike(commentId, newHeartButton);
                    });
                });
            }, (error) => {
                console.error("Error fetching comments:", error);
                showModal("Error", "Could not load comments.");
            });
        }
        
        // Firestore profile likes functionality
        function setupProfileLikesListener() {
            // Unsubscribe from any previous listener
            if (unsubscribeFromLikes) {
                unsubscribeFromLikes();
                unsubscribeFromLikes = null;
            }

            // Check if user is authenticated before setting up the listener
            if (!auth || !auth.currentUser || auth.currentUser.isAnonymous) {
                 // On initial load, explicitly ensure the heart is not liked
                heartBtn.classList.remove('liked');
                profileLikesCount.textContent = 0;
                return;
            }
            
            const profileLikesRef = doc(db, `/artifacts/${appId}/public/data/profileLikes/profile`);

            unsubscribeFromLikes = onSnapshot(profileLikesRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const likedBy = data.likedBy || [];
                    const likeCount = likedBy.length;
                    
                    profileLikesCount.textContent = likeCount;

                    // Check if the current user's ID is in the likedBy array
                    const userId = auth.currentUser.uid;
                    if (likedBy.includes(userId)) {
                        heartBtn.classList.add('liked');
                    } else {
                        heartBtn.classList.remove('liked');
                    }
                } else {
                    // Document doesn't exist, reset UI
                    profileLikesCount.textContent = 0;
                    heartBtn.classList.remove('liked');
                }
            }, (error) => {
                console.error("Error fetching profile likes:", error);
                showModal("Error", "Could not load profile likes.");
            });
        }
        
        // Comment form submission
        const commentForm = document.getElementById('comment-form');
        commentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const commentInput = document.getElementById('comment-input');
            const commentText = commentInput.value.trim();

            if (!auth || !auth.currentUser || auth.currentUser.isAnonymous) {
                showAuthModal();
                return;
            }

            if (commentText === '') {
                showModal("Input Required", "Please write a comment before posting.");
                return;
            }
            
            try {
                const commentsPath = `/artifacts/${appId}/public/data/comments`;
                await addDoc(collection(db, commentsPath), {
                    userId: auth.currentUser.uid,
                    userName: auth.currentUser.displayName,
                    text: commentText,
                    timestamp: serverTimestamp(),
                    likedBy: [] // Initialize likes as an empty array
                });
                commentInput.value = ''; // Clear the input field
            } catch (error) {
                console.error("Error adding comment:", error);
                showModal("Error", "Failed to post comment.");
            }
        });

        // Contact form submission logic
        const contactForm = document.getElementById('contact-form');
        const contactSuccessMessage = document.getElementById('contact-success-message');
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent the default form submission (page reload)

            const name = document.getElementById('contact-name').value.trim();
            const email = document.getElementById('contact-email').value.trim();
            const message = document.getElementById('contact-message').value.trim();

            if (!name || !email || !message) {
                showModal('Validation Error', 'Please fill out all fields before sending your message.');
                return;
            }

            // Check if user is authenticated (even anonymously)
            if (!auth || !auth.currentUser) {
                 showModal("Authentication Required", "Please refresh the page to enable anonymous sign-in before sending a message.");
                 return;
            }
            
            try {
                // Add the contact message to a new 'contactMessages' collection
                const contactPath = `/artifacts/${appId}/public/data/contactMessages`;
                await addDoc(collection(db, contactPath), {
                    name,
                    email,
                    message,
                    timestamp: serverTimestamp() // Add a server-side timestamp
                });

                // Hide the form and show the success message
                contactForm.classList.add('hidden');
                contactSuccessMessage.classList.remove('hidden');

            } catch (error) {
                console.error('Error adding contact message:', error);
                showModal('Error', 'Failed to send your message. Please try again.');
            }
        });
    </script>
</body>
</html>
